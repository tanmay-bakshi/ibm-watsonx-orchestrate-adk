{
  "spec": {
    "kind": "flow",
    "name": "document_processing_flow",
    "display_name": "document_processing_flow",
    "description": "Process documents",
    "input_schema": {
      "$ref": "#/schemas/document_processing_flow_input"
    },
    "schedulable": false
  },
  "nodes": {
    "get_kvp_schemas_for_invoice": {
      "spec": {
        "kind": "tool",
        "name": "get_kvp_schemas_for_invoice",
        "display_name": "get_kvp_schemas_for_invoice",
        "description": "Return a DocProcKVPSchema object",
        "input_schema": {
          "$ref": "#/schemas/get_kvp_schemas_for_invoice_input"
        },
        "output_schema": {
          "type": "array",
          "description": "A DocProcKVPSchema object",
          "items": {}
        },
        "tool": "get_kvp_schemas_for_invoice"
      }
    },
    "get_kvp_schemas_for_utility_bill": {
      "spec": {
        "kind": "tool",
        "name": "get_kvp_schemas_for_utility_bill",
        "display_name": "get_kvp_schemas_for_utility_bill",
        "description": "Return a DocProcKVPSchema object",
        "input_schema": {
          "$ref": "#/schemas/get_kvp_schemas_for_utility_bill_input"
        },
        "output_schema": {
          "type": "array",
          "description": "A DocProcKVPSchema object",
          "items": {}
        },
        "tool": "get_kvp_schemas_for_utility_bill"
      }
    },
    "doc_ext_node": {
      "spec": {
        "kind": "docext",
        "name": "doc_ext_node",
        "display_name": "doc_ext_node",
        "description": "Extracts custom field values (key-value-pairs) from a document using different extraction schemas.",
        "input_schema": {
          "$ref": "#/schemas/doc_ext_node_input"
        },
        "output_schema": {
          "$ref": "#/schemas/DocExtFieldValue"
        },
        "task": "custom_field_extraction",
        "enable_hw": true,
        "version": "TIP",
        "config": {
          "domain": "other",
          "type": "agreement",
          "llm": "watsonx/meta-llama/llama-3-2-11b-vision-instruct",
          "fields": [
            {
              "name": "Buyer",
              "type": "string",
              "description": "",
              "field_name": "buyer",
              "multiple_mentions": false,
              "example_value": "",
              "examples": []
            },
            {
              "name": "Seller",
              "type": "string",
              "description": "",
              "field_name": "seller",
              "multiple_mentions": false,
              "example_value": "",
              "examples": []
            },
            {
              "name": "Agreement Date",
              "type": "date",
              "description": "",
              "field_name": "agreement_date",
              "multiple_mentions": false,
              "example_value": "",
              "examples": []
            }
          ],
          "field_extraction_method": "classic"
        },
        "min_confidence": 0.0,
        "review_fields": [],
        "enable_review": false
      }
    },
    "document_classifier_node": {
      "spec": {
        "kind": "docclassifier",
        "name": "document_classifier_node",
        "display_name": "document_classifier_node",
        "description": "Classifies documents into a custom class.",
        "input_schema": {
          "$ref": "#/schemas/document_classifier_node_input"
        },
        "output_schema": {
          "$ref": "#/schemas/DocumentClassificationResponse"
        },
        "task": "custom_document_classification",
        "enable_hw": false,
        "version": "TIP",
        "config": {
          "domain": "other",
          "type": "class_configuration",
          "llm": "watsonx/meta-llama/llama-3-2-11b-vision-instruct",
          "min_confidence": 0.0,
          "classes": [
            {
              "class_name": "invoice",
              "class_id": "e1616849-0a16-509e-a495-354d223495bd"
            },
            {
              "class_name": "bill_of_lading",
              "class_id": "0de29853-4383-5e8e-b632-8e21b502e7dc"
            },
            {
              "class_name": "contract",
              "class_id": "f2cc6e9f-d85c-56f6-bcf8-f1a034be4e0f"
            },
            {
              "class_name": "purchase_order",
              "class_id": "01da16c6-e439-563c-a478-b17d0d68a94d"
            },
            {
              "class_name": "utility_bill",
              "class_id": "eccc8573-edb0-5334-a907-f6b30ba90a19"
            },
            {
              "class_name": "tax_form",
              "class_id": "79002f57-a649-52c0-bb2e-7f4118fa37a9"
            }
          ]
        },
        "enable_review": false
      }
    },
    "text_extraction_with_document_structure_for_invoice": {
      "spec": {
        "kind": "docproc",
        "name": "text_extraction_with_document_structure_for_invoice",
        "display_name": "text_extraction_node",
        "description": "Extracts the raw text and semantic structure from a document.",
        "input_schema": {
          "$ref": "#/schemas/text_extraction_with_document_structure_for_invoice_input"
        },
        "output_schema": {
          "$ref": "#/schemas/TextExtractionResponse"
        },
        "task": "text_extraction",
        "enable_hw": true,
        "document_structure": true,
        "kvp_enable_text_hints": true
      },
      "input_map": {
        "spec": {
          "maps": [
            {
              "target_variable": "self.input.kvp_schemas",
              "value_expression": "flow.get_kvp_schemas_for_invoice_tool_node.output",
              "has_no_value": false,
              "default_value": null,
              "metadata": {
                "assignmentType": "pyExpression"
              }
            }
          ]
        }
      }
    },
    "text_extraction_with_document_structure_for_utility_bill": {
      "spec": {
        "kind": "docproc",
        "name": "text_extraction_with_document_structure_for_utility_bill",
        "display_name": "text_extraction_node",
        "description": "Extracts the raw text and semantic structure from a document.",
        "input_schema": {
          "$ref": "#/schemas/text_extraction_with_document_structure_for_utility_bill_input"
        },
        "output_schema": {
          "$ref": "#/schemas/TextExtractionResponse"
        },
        "task": "text_extraction",
        "enable_hw": true,
        "document_structure": true,
        "kvp_enable_text_hints": true
      },
      "input_map": {
        "spec": {
          "maps": [
            {
              "target_variable": "self.input.kvp_schemas",
              "value_expression": "flow.get_kvp_schemas_for_utility_bill_tool_node.output",
              "has_no_value": false,
              "default_value": null,
              "metadata": {
                "assignmentType": "pyExpression"
              }
            }
          ]
        }
      }
    },
    "branch_1": {
      "spec": {
        "kind": "branch",
        "name": "branch_1",
        "display_name": "branch_1",
        "evaluator": {
          "conditions": [
            {
              "expression": "flow.document_classifier_node.output.class_name.strip().lower() in ['invoice','bill_of_lading']",
              "node_id": "get_kvp_schemas_for_invoice",
              "default": false
            },
            {
              "expression": "flow.document_classifier_node.output.class_name.strip().lower() in ['utility_bill']",
              "node_id": "get_kvp_schemas_for_utility_bill",
              "default": false
            },
            {
              "expression": "flow.document_classifier_node.output.class_name.strip().lower() in ['contract','purchase_order']",
              "node_id": "doc_ext_node",
              "default": false
            },
            {
              "node_id": "doc_ext_node",
              "default": true
            }
          ]
        },
        "cases": {},
        "match_policy": "FIRST_MATCH"
      }
    },
    "__start__": {
      "spec": {
        "kind": "start",
        "name": "__start__",
        "display_name": "__start__"
      }
    },
    "__end__": {
      "spec": {
        "kind": "end",
        "name": "__end__",
        "display_name": "__end__"
      }
    }
  },
  "edges": [
    {
      "start": "branch_1",
      "end": "get_kvp_schemas_for_invoice"
    },
    {
      "start": "branch_1",
      "end": "get_kvp_schemas_for_utility_bill"
    },
    {
      "start": "branch_1",
      "end": "doc_ext_node"
    },
    {
      "start": "__start__",
      "end": "document_classifier_node"
    },
    {
      "start": "document_classifier_node",
      "end": "branch_1"
    },
    {
      "start": "get_kvp_schemas_for_invoice",
      "end": "text_extraction_with_document_structure_for_invoice"
    },
    {
      "start": "get_kvp_schemas_for_utility_bill",
      "end": "text_extraction_with_document_structure_for_utility_bill"
    },
    {
      "start": "text_extraction_with_document_structure_for_utility_bill",
      "end": "__end__"
    },
    {
      "start": "text_extraction_with_document_structure_for_invoice",
      "end": "__end__"
    },
    {
      "start": "doc_ext_node",
      "end": "__end__"
    }
  ],
  "schemas": {
    "document_processing_flow_input": {
      "type": "object",
      "title": "document_processing_flow_input",
      "required": [],
      "properties": {
        "document_ref": {
          "title": "Document reference",
          "description": "Either an ID or a URL identifying the document to be used.",
          "format": "binary",
          "anyOf": [
            {
              "type": "string",
              "format": "binary"
            },
            {
              "type": "string",
              "title": "File reference",
              "description": "A URL identifying the File to be used.",
              "format": "wxo-file"
            },
            {
              "type": "null"
            }
          ]
        }
      }
    },
    "get_kvp_schemas_for_invoice_input": {
      "type": "object",
      "title": "get_kvp_schemas_for_invoice_input",
      "required": [
        "place_holder"
      ],
      "properties": {
        "place_holder": {
          "type": "string",
          "title": "Place Holder",
          "description": "str object"
        }
      }
    },
    "get_kvp_schemas_for_utility_bill_input": {
      "type": "object",
      "title": "get_kvp_schemas_for_utility_bill_input",
      "required": [
        "place_holder"
      ],
      "properties": {
        "place_holder": {
          "type": "string",
          "title": "Place Holder",
          "description": "str object"
        }
      }
    },
    "doc_ext_node_input": {
      "type": "object",
      "title": "doc_ext_node_input",
      "required": [],
      "properties": {
        "document_ref": {
          "title": "Document reference",
          "description": "Either an ID or a URL identifying the document to be used.",
          "format": "binary",
          "anyOf": [
            {
              "type": "string",
              "format": "binary"
            },
            {
              "type": "string",
              "title": "File reference",
              "description": "A URL identifying the File to be used.",
              "format": "wxo-file"
            },
            {
              "type": "null"
            }
          ]
        }
      }
    },
    "DocExtFieldValue": {
      "type": "object",
      "title": "DocExtFieldValue",
      "required": [
        "buyer",
        "seller",
        "agreement_date"
      ],
      "properties": {
        "buyer": {
          "type": "string",
          "title": "Buyer",
          "description": "Extracted value for Buyer"
        },
        "seller": {
          "type": "string",
          "title": "Seller",
          "description": "Extracted value for Seller"
        },
        "agreement_date": {
          "type": "string",
          "title": "Agreement Date",
          "description": "Extracted value for Agreement Date",
          "format": "date"
        }
      }
    },
    "document_classifier_node_input": {
      "type": "object",
      "title": "document_classifier_node_input",
      "required": [],
      "properties": {
        "document_ref": {
          "title": "Document reference",
          "description": "Either an ID or a URL identifying the document to be used.",
          "format": "binary",
          "anyOf": [
            {
              "type": "string",
              "format": "binary"
            },
            {
              "type": "string",
              "title": "File reference",
              "description": "A URL identifying the File to be used.",
              "format": "wxo-file"
            },
            {
              "type": "null"
            }
          ]
        }
      }
    },
    "Custom Classification": {
      "type": "object",
      "title": "Custom Classification",
      "description": "The Class extracted by the llm",
      "properties": {
        "class_name": {
          "type": "string",
          "title": "Class Name",
          "description": "Class Name of the Document",
          "default": []
        }
      }
    },
    "DocumentClassificationResponse": {
      "type": "object",
      "title": "DocumentClassificationResponse",
      "required": [
        "custom_class_response"
      ],
      "properties": {
        "custom_class_response": {
          "title": "Custom Classification",
          "$ref": "#/schemas/Custom Classification"
        }
      }
    },
    "text_extraction_with_document_structure_for_invoice_input": {
      "type": "object",
      "title": "text_extraction_with_document_structure_for_invoice_input",
      "required": [],
      "properties": {
        "document_ref": {
          "title": "Document reference",
          "description": "Either an ID or a URL identifying the document to be used.",
          "format": "binary",
          "anyOf": [
            {
              "type": "string",
              "format": "binary"
            },
            {
              "type": "string",
              "title": "File reference",
              "description": "A URL identifying the File to be used.",
              "format": "wxo-file"
            },
            {
              "type": "null"
            }
          ]
        },
        "kvp_schemas": {
          "title": "KVP schemas",
          "description": "Optional list of key-value pair schemas to use for extraction.",
          "anyOf": [
            {
              "type": "array",
              "items": {
                "type": "object",
                "title": "DocProcKVPSchema",
                "required": [
                  "document_type",
                  "document_description",
                  "fields"
                ],
                "properties": {
                  "document_type": {
                    "type": "string",
                    "title": "Document Type",
                    "description": "A label for the kind of documents we want to extract"
                  },
                  "document_description": {
                    "type": "string",
                    "title": "Document Description",
                    "description": "A description of the kind of documents we want to extractI. This is used to select which schema to use for extraction."
                  },
                  "additional_prompt_instructions": {
                    "title": "Additional Prompt Instructions",
                    "description": "Additional instructions to guide the extraction. This is used to provide more context to the model about the document.",
                    "anyOf": [
                      {
                        "type": "string"
                      },
                      {
                        "type": "null"
                      }
                    ]
                  },
                  "fields": {
                    "type": "object",
                    "title": "Fields",
                    "description": "The fields to extract from the document. These are the keys in the KVP extraction result.",
                    "additionalProperties": {
                      "anyOf": [
                        {
                          "properties": {
                            "description": {
                              "description": "A description of the field to extract from the document.",
                              "title": "Description",
                              "type": "string"
                            },
                            "example": {
                              "default": "",
                              "description": "An example of the field to extract from the document.",
                              "title": "Example",
                              "type": "string"
                            },
                            "default": {
                              "anyOf": [
                                {
                                  "type": "string"
                                },
                                {
                                  "type": "null"
                                }
                              ],
                              "default": "",
                              "description": "A default value for the field to extract from the document.",
                              "title": "Default"
                            },
                            "available_options": {
                              "anyOf": [
                                {
                                  "items": {
                                    "type": "string"
                                  },
                                  "type": "array"
                                },
                                {
                                  "type": "null"
                                }
                              ],
                              "default": null,
                              "description": "A list of possible values for the field.",
                              "title": "Available Options"
                            }
                          },
                          "required": [
                            "description"
                          ],
                          "title": "DocProcField",
                          "type": "object"
                        },
                        {
                          "properties": {
                            "type": {
                              "const": "array",
                              "title": "Type",
                              "type": "string"
                            },
                            "description": {
                              "description": "A description of the table to extract from the document.",
                              "title": "Description",
                              "type": "string"
                            },
                            "columns": {
                              "additionalProperties": {
                                "properties": {
                                  "description": {
                                    "description": "A description of the field to extract from the document.",
                                    "title": "Description",
                                    "type": "string"
                                  },
                                  "example": {
                                    "default": "",
                                    "description": "An example of the field to extract from the document.",
                                    "title": "Example",
                                    "type": "string"
                                  },
                                  "default": {
                                    "anyOf": [
                                      {
                                        "type": "string"
                                      },
                                      {
                                        "type": "null"
                                      }
                                    ],
                                    "default": "",
                                    "description": "A default value for the field to extract from the document.",
                                    "title": "Default"
                                  },
                                  "available_options": {
                                    "anyOf": [
                                      {
                                        "items": {
                                          "type": "string"
                                        },
                                        "type": "array"
                                      },
                                      {
                                        "type": "null"
                                      }
                                    ],
                                    "default": null,
                                    "description": "A list of possible values for the field.",
                                    "title": "Available Options"
                                  }
                                },
                                "required": [
                                  "description"
                                ],
                                "title": "DocProcField",
                                "type": "object"
                              },
                              "description": "The columns to extract from the table. These are the keys in the table extraction result.",
                              "title": "Columns",
                              "type": "object"
                            }
                          },
                          "required": [
                            "type",
                            "description",
                            "columns"
                          ],
                          "title": "DocProcTable",
                          "type": "object"
                        }
                      ]
                    }
                  }
                }
              }
            },
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ]
        },
        "kvp_model_name": {
          "title": "KVP Model Name",
          "description": "The LLM model to be used for key-value pair extraction",
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ]
        },
        "kvp_force_schema_name": {
          "title": "KVP Force Schema Name",
          "description": "Forces the kvp extractor to use a specified schema directly for value extraction by setting the schema document_type.",
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ]
        },
        "kvp_enable_text_hints": {
          "title": "KVP Enable Text Hints",
          "description": "Determines whether to use text hints such as the text and layout information extracted from the document when extracting values in addition to the page image (True), or just rely on the page image itself (False)",
          "default": true,
          "anyOf": [
            {
              "type": "boolean"
            },
            {
              "type": "null"
            }
          ]
        }
      }
    },
    "TextExtractionResponse": {
      "type": "object",
      "title": "TextExtractionResponse",
      "description": "The text extraction operation response when output_format is set to \"docref\" (default).\nAttributes:\n    output_file_ref (str): The url to the file that contains the extracted text and kvps.",
      "required": [
        "output_file_ref"
      ],
      "properties": {
        "output_file_ref": {
          "type": "string",
          "title": "output_file_ref",
          "description": "The url to the file that contains the extracted text and kvps."
        }
      }
    },
    "text_extraction_with_document_structure_for_utility_bill_input": {
      "type": "object",
      "title": "text_extraction_with_document_structure_for_utility_bill_input",
      "required": [],
      "properties": {
        "document_ref": {
          "title": "Document reference",
          "description": "Either an ID or a URL identifying the document to be used.",
          "format": "binary",
          "anyOf": [
            {
              "type": "string",
              "format": "binary"
            },
            {
              "type": "string",
              "title": "File reference",
              "description": "A URL identifying the File to be used.",
              "format": "wxo-file"
            },
            {
              "type": "null"
            }
          ]
        },
        "kvp_schemas": {
          "title": "KVP schemas",
          "description": "Optional list of key-value pair schemas to use for extraction.",
          "anyOf": [
            {
              "type": "array",
              "items": {
                "type": "object",
                "title": "DocProcKVPSchema",
                "required": [
                  "document_type",
                  "document_description",
                  "fields"
                ],
                "properties": {
                  "document_type": {
                    "type": "string",
                    "title": "Document Type",
                    "description": "A label for the kind of documents we want to extract"
                  },
                  "document_description": {
                    "type": "string",
                    "title": "Document Description",
                    "description": "A description of the kind of documents we want to extractI. This is used to select which schema to use for extraction."
                  },
                  "additional_prompt_instructions": {
                    "title": "Additional Prompt Instructions",
                    "description": "Additional instructions to guide the extraction. This is used to provide more context to the model about the document.",
                    "anyOf": [
                      {
                        "type": "string"
                      },
                      {
                        "type": "null"
                      }
                    ]
                  },
                  "fields": {
                    "type": "object",
                    "title": "Fields",
                    "description": "The fields to extract from the document. These are the keys in the KVP extraction result.",
                    "additionalProperties": {
                      "anyOf": [
                        {
                          "properties": {
                            "description": {
                              "description": "A description of the field to extract from the document.",
                              "title": "Description",
                              "type": "string"
                            },
                            "example": {
                              "default": "",
                              "description": "An example of the field to extract from the document.",
                              "title": "Example",
                              "type": "string"
                            },
                            "default": {
                              "anyOf": [
                                {
                                  "type": "string"
                                },
                                {
                                  "type": "null"
                                }
                              ],
                              "default": "",
                              "description": "A default value for the field to extract from the document.",
                              "title": "Default"
                            },
                            "available_options": {
                              "anyOf": [
                                {
                                  "items": {
                                    "type": "string"
                                  },
                                  "type": "array"
                                },
                                {
                                  "type": "null"
                                }
                              ],
                              "default": null,
                              "description": "A list of possible values for the field.",
                              "title": "Available Options"
                            }
                          },
                          "required": [
                            "description"
                          ],
                          "title": "DocProcField",
                          "type": "object"
                        },
                        {
                          "properties": {
                            "type": {
                              "const": "array",
                              "title": "Type",
                              "type": "string"
                            },
                            "description": {
                              "description": "A description of the table to extract from the document.",
                              "title": "Description",
                              "type": "string"
                            },
                            "columns": {
                              "additionalProperties": {
                                "properties": {
                                  "description": {
                                    "description": "A description of the field to extract from the document.",
                                    "title": "Description",
                                    "type": "string"
                                  },
                                  "example": {
                                    "default": "",
                                    "description": "An example of the field to extract from the document.",
                                    "title": "Example",
                                    "type": "string"
                                  },
                                  "default": {
                                    "anyOf": [
                                      {
                                        "type": "string"
                                      },
                                      {
                                        "type": "null"
                                      }
                                    ],
                                    "default": "",
                                    "description": "A default value for the field to extract from the document.",
                                    "title": "Default"
                                  },
                                  "available_options": {
                                    "anyOf": [
                                      {
                                        "items": {
                                          "type": "string"
                                        },
                                        "type": "array"
                                      },
                                      {
                                        "type": "null"
                                      }
                                    ],
                                    "default": null,
                                    "description": "A list of possible values for the field.",
                                    "title": "Available Options"
                                  }
                                },
                                "required": [
                                  "description"
                                ],
                                "title": "DocProcField",
                                "type": "object"
                              },
                              "description": "The columns to extract from the table. These are the keys in the table extraction result.",
                              "title": "Columns",
                              "type": "object"
                            }
                          },
                          "required": [
                            "type",
                            "description",
                            "columns"
                          ],
                          "title": "DocProcTable",
                          "type": "object"
                        }
                      ]
                    }
                  }
                }
              }
            },
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ]
        },
        "kvp_model_name": {
          "title": "KVP Model Name",
          "description": "The LLM model to be used for key-value pair extraction",
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ]
        },
        "kvp_force_schema_name": {
          "title": "KVP Force Schema Name",
          "description": "Forces the kvp extractor to use a specified schema directly for value extraction by setting the schema document_type.",
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ]
        },
        "kvp_enable_text_hints": {
          "title": "KVP Enable Text Hints",
          "description": "Determines whether to use text hints such as the text and layout information extracted from the document when extracting values in addition to the page image (True), or just rely on the page image itself (False)",
          "default": true,
          "anyOf": [
            {
              "type": "boolean"
            },
            {
              "type": "null"
            }
          ]
        }
      }
    }
  },
  "metadata": {
    "source_kind": "adk/python",
    "compiled_on": "2026-01-15T23:53:56.753595+00:00"
  }
}